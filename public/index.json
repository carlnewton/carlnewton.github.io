[{"content":"","date":null,"permalink":"/","section":"Carl Newton","summary":"","title":"Carl Newton"},{"content":" I have not failed 700 times. I’ve succeeded in proving 700 ways how not to build a light bulb.\nThis is apparently the response that Thomas Edison gave to a reporter when asked about his repeated failures in attempting to invent the light bulb. I say apparently because the exact quote is disputed, as is the validity of Edison\u0026rsquo;s accomplishments. I don\u0026rsquo;t know, I\u0026rsquo;m no historian, but I sure do like the positivity of the quote!\nDevelopment often feels this way, banging your head against an error for what feels like a lifetime, only to celebrate the success of having the opportunity to bang your head against a different error. The last few months have been no exception.\nThe Problem #To bring you up to speed, I\u0026rsquo;m Building Habitat: A free and open source self-hosted social platform for local communities. I have plans for it to be decentralised.\nFor a while now, I\u0026rsquo;ve been struggling with the difficulty of using Ansible provisioning for Linux server hosting, along with using PHP Deployer and Docker for those who might want to host an instance of Habitat on their own machine, or if they have very deep pockets, Cloud Docker hosting.\nMy initial preference for hosting was with Docker, and so initially it got a lot of attention in development. After trying it out, and finding that the costs for Cloud hosting were egregiously expensive, I decided to focus on installation on an AWS EC2 instance. My efforts with Docker had fallen by the wayside in favour of Ansible.\nI still wanted to make sure that Docker was supported, but it had taken a backseat, and my efforts had been effectively doubled. Everything I built had to be tested on both types of environments.\nA Guiding Lightning Strike #Earlier this year, it seems that my project got the attention of Nutomic, a maintainer of Lemmy. This is exciting news for me. Lemmy is a federated, free and open source, self-hosted social platform. Does this sound familiar at all?\nHabitat could certainly benefit from the lessons that Lemmy has had over the years. Nutomic posted on my project board, and I snatched up the opportunity to ask him about provisioning and deployment techniques. Here\u0026rsquo;s what he said:\nWhat we are doing is Docker, with Ansible to set it up. So you can use both of them together to simplify things.\n\u0026ndash; Nutomic, A smarter person than me\nIt\u0026rsquo;s one of those solutions that seems so simple that it should\u0026rsquo;ve been obvious from the outset. Though just because the solution was simple in design, it doesn\u0026rsquo;t mean that it was a simple thing to implement. I\u0026rsquo;ve been pulling my hair out for a couple of months over this now, but I think I\u0026rsquo;m finally in a good place with it.\nThe Solution #Here is a simplified model of the architecture as it currently exists:\nflowchart TB subgraph Docker Compose subgraph PHP Apache container A([Apache]) end subgraph MariaDB container M([MariaDB]) A-.-M end end subgraph Filesystem UF(Uploaded files) A-.-|Volume mount|UF SC(SSL Certificate) HA(Habitat Application) A-.-|Volume mount|HA DB(Database) M-.-|Volume mount|DB end A-.-|Volume mount|SC C([Certbot])-.-SC Ansible #First, we create the required directories:\n- name: Create the directory for which user uploaded files will live file: path: /opt/my-project/uploaded-files state: directory mode: 0755 - name: Create the directory for the database to be managed by MariaDB file: path: /opt/my-project/db state: directory mode: 0755 - name: Copy the Docker Compose instructions from the repository to a new directory copy: src: files/docker-compose dest: /opt/my-project/ mode: 0755 - name: Download the repository for the Application get_url: url: \u0026#34;{{ application_repo_url }}/archive/refs/heads/{{ application_repo_version }}.zip\u0026#34; dest: /tmp register: application_archive - name: Unarchive the application unarchive: src: \u0026#34;{{ application_archive.dest }}\u0026#34; dest: /tmp remote_src: yes list_files: yes register: application_unarchive - name: Move application directory command: \u0026#34;mv /tmp/{{ application_unarchive.files[0] }}/App/ /opt/my-project/app\u0026#34; Given that Habitat has an AGPL licence, the administrator must make the source code available to the end users. Making this easy to adhere to is another thing I\u0026rsquo;d like to automate. Despite the application files already existing locally, instead of uploading them from the local machine, I\u0026rsquo;ve decided here to use variables to download the application from the public repository. These variables can later be used in the application to link to the public repository. It\u0026rsquo;s also a lot faster than using Ansible to copy each of the files.\nNext up, we deal with automating the creation of an SSL certificate.\n- name: Generate a new SSL certificate shell: | certbot certonly --standalone --non-interactive --agree-tos --email {{ email_address }} -d {{ domain }} - name: Create a cron job for certbot auto renewal cron: name: \u0026#34;Auto-renew letsencrypt certificate with certbot\u0026#34; minute: \u0026#34;0\u0026#34; hour: \u0026#34;1\u0026#34; day: \u0026#34;*\u0026#34; month: \u0026#34;*\u0026#34; weekday: \u0026#34;0\u0026#34; job: \u0026#34;certbot renew --post-hook \u0026#39;docker compose -f /opt/my-project/docker-compose/docker-compose.yaml restart php-apache\u0026#39;\u0026#34; user: \u0026#34;root\u0026#34; This checks the current status of the SSL certificate once a week, and if it\u0026rsquo;s due to expire, it generates a new one and then restarts the PHP Apache container.\nThe final step of the playbook is to run the Docker compose up:\n- name: Run docker compose up community.docker.docker_compose_v2: project_src: /opt/my-project/docker-compose That\u0026rsquo;s the outermost layer done! Onto the detail of that Docker Compose setup.\nDocker Compose #Firstly, let\u0026rsquo;s look at the simpler container, MariaDB:\ndb: container_name: \u0026#34;my-project-mariadb\u0026#34; image: mariadb:latest healthcheck: test: [\u0026#34;CMD\u0026#34;, \u0026#34;healthcheck.sh\u0026#34;, \u0026#34;--connect\u0026#34;, \u0026#34;--innodb_initialized\u0026#34;] start_period: 10s interval: 10s timeout: 5s retries: 3 environment: - MARIADB_ROOT_USER=root - MARIADB_ROOT_PASSWORD=${MARIADB_PASSWORD} - MARIADB_USER=${MARIADB_USER} - MARIADB_PASSWORD=${MARIADB_PASSWORD} - MARIADB_DATABASE=${MARIADB_DATABASE} volumes: - /opt/my-project/db:/var/lib/mysql:rw ports: - \u0026#34;3306:3306\u0026#34; restart: always We attach the db directory created earlier as a volume, supply the credentials and create a health check for which the Apache container can query.\nOnto the Apache container:\nphp-apache: container_name: \u0026#34;my-project-php-apache\u0026#34; depends_on: db: condition: service_healthy build: ./php-apache healthcheck: test: [\u0026#34;CMD\u0026#34;, \u0026#34;curl\u0026#34;, \u0026#34;-f\u0026#34;, \u0026#34;http://localhost/\u0026#34;] interval: 30s timeout: 10s retries: 10 environment: - MARIADB_USER=${MARIADB_USER} - MARIADB_PASSWORD=${MARIADB_PASSWORD} - MARIADB_DATABASE=${MARIADB_DATABASE} volumes: - /opt/my-project/app:/var/www/html - /opt/my-project/uploaded-files:/var/www/uploads - /etc/letsencrypt:/etc/letsencrypt ports: - \u0026#34;80:80\u0026#34; - \u0026#34;443:443\u0026#34; restart: always Here we are forwarding the HTTP and HTTPS ports and mounting the application, uploaded files and letsencrypt directories for the application to use. We are also sending it the same database credentials.\nThe configuration examples here lack a few extra details that I\u0026rsquo;ve added specifically for Habitat, you can always go and take a look at the repository if you want to see more detail.\n","date":"5 April 2025","permalink":"/posts/deployment-techniques/","section":"Posts","summary":"","title":"Deployment Processes - Finding Another Way to Not Build a Light Bulb"},{"content":"","date":null,"permalink":"/tags/fediverse/","section":"Tags","summary":"","title":"Fediverse"},{"content":"","date":null,"permalink":"/tags/habitat/","section":"Tags","summary":"","title":"Habitat"},{"content":"","date":null,"permalink":"/posts/","section":"Posts","summary":"","title":"Posts"},{"content":"","date":null,"permalink":"/tags/projects/","section":"Tags","summary":"","title":"Projects"},{"content":"","date":null,"permalink":"/tags/","section":"Tags","summary":"","title":"Tags"},{"content":"A few months ago I created this blog for the very purpose of sharing an idea of a decentralised social platform based on your location. In posting and sharing it, I was hoping to find out if anyone else would find such a social network valuable, and if anyone with any experience building for the fediverse had any reason to believe that it wouldn\u0026rsquo;t be technically possible.\nAt the time of writing the post, I wasn\u0026rsquo;t convinced that I\u0026rsquo;d be building the social platform myself. If I\u0026rsquo;m honest, I was hoping that someone with experience building for the fediverse would feel inspired to take up the project themselves! After all, what do I know about building a social network?\nIt was only after reading and hearing such positive feedback, and finding that other people were as excited as I am about a local platform, that I decided I was going to give it my best.\nYour Feedback #Thankfully, I didn\u0026rsquo;t get any feedback that indicated that there would be any technical issues I\u0026rsquo;ve overlooked which would prevent a network of Habitat instances from communicating with one another effectively, but most of the feedback I received online appears to have been from users of fediverse services, not developers. So I\u0026rsquo;m still fearfully awaiting that bombshell!\nI did have one federated forum developer let me know that he\u0026rsquo;ll be stealing the idea of using Gossip Protocol for instance discovery, and I\u0026rsquo;m all for it \u0026ndash; steal away!\nI\u0026rsquo;ve had a great deal of feedback from fediverse users and friends and family who are generally excited about the idea of a social platform that is focused on local information.\nIt\u0026rsquo;s not all sunshine and rainbows though, I have received some doubt, criticism and questions, so I thought I\u0026rsquo;d go into some of that here.\n\u0026ldquo;It won\u0026rsquo;t catch on\u0026rdquo; #I think this is probably the most vocal criticism I\u0026rsquo;ve received about the idea, and at first, I saw it as a valid reason not to attempt it. Initially, I saw this issue as the most likely cause for failure. If you build a social platform around the concept of segmenting groups of people by location, there is a very real possibility that people would fall into the catch-22 of not using it because nobody uses it.\nIn fact, in my original post, I explored a potential solution for this very problem. After some thought, I\u0026rsquo;ve decided to revoke that idea. One Lemmy user put it very well:\nOne advantage to a system like this, is that you don’t need it to catch on in a bunch of different communities for it to work. It can catch on even in one place, and it will already be useful for the people there.\nDon\u0026rsquo;t get me wrong, I would love the Nearby feed to work anywhere in the world, and for that to be a reality, it would need to catch on. But I now feel that it\u0026rsquo;s crucial to take the approach of fostering one\u0026rsquo;s own community. If I can make it a success in my local town, perhaps you could make it a success in yours.\n\u0026ldquo;Isn\u0026rsquo;t this just Nextdoor?\u0026rdquo; #I had variations of this question for a bunch of social platforms, but Nextdoor was the most common comparison. Putting aside that Habitat will be federated, free and open-source software, a Neighbourhood Watch kind of social network is not what I\u0026rsquo;m going for. In theory, if an instance administrator wanted to make a category for such discussions, they could. They could also make a Spotted category to mirror those kinds of Facebook groups if they wanted. But the purpose is to provide an experience around location as the subject with no direction on the kinds of discussions that happen around those locations, only to categorise them accordingly.\nPersonally, I\u0026rsquo;m most excited about posting and asking questions about local landmarks and areas of natural beauty. But it\u0026rsquo;s up to the communities themselves to decide the conversation.\n\u0026ldquo;Why reinvent the wheel?\u0026rdquo; #I had a lot of people telling me that I should just launch an instance of Mastodon or Lemmy and give it the name of my local town. I have two answers to this:\nThere is nothing that I can find that provides the functionality I think would prove useful for local communities Where\u0026rsquo;s the fun in that?! Why not reinvent the wheel? I\u0026rsquo;ve already learned a great deal in just starting this project, and I\u0026rsquo;m excited to learn a great deal more.\nThe Plan #Habitat will be built in three phases, and while I may be posting here to explore some ideas for the future phases, I won\u0026rsquo;t begin work on a phase until I\u0026rsquo;m satisfied that the prior phases have been completed to a good standard.\nPhase 1: Core #Before worrying about how Habitat instances will connect, it\u0026rsquo;s first important to ensure that the functionality will provide a good and usable experience in any isolated instance. This is why phase 1 will focus solely on the user experience in their local area. Getting this right before moving on to the next step is crucial to build something worthwhile.\nPhase 2: Mesh #The Mesh phase will focus on communication between Habitat instances to allow the user to see posts from any locationally relevant instance that is connected to the network. It will need to be designed carefully to prevent bad actors from flooding the network with spam while ensuring that newly created instances can be adopted into the network with ease.\nPhase 3: Flow #The third and final phase will introduce the ability for users to interact with posts between instances. The user should not need to sign up to a different instance to comment on a post from another instance. This phase will most likely introduce the use of ActivityPub and may require a great deal of rewriting.\nA Sneak Peek #I thought I\u0026rsquo;d quickly demo the end-user experience as it is at the moment. Forgive the black bars and the placeholder content, I\u0026rsquo;m still developing locally in browser mode for the time being.\nBrowsing # Posting # Get Involved #If you\u0026rsquo;re a developer with experience or desire to work with Docker, Symfony, HTMX, Bootstrap or Leaflet, I would greatly appreciate any help or input.\nIf you have no desire to work on this project but can give advice on managing Open Source projects, that would also be tremendously valuable.\nIf you have no experience in software development in any capacity but are interested in the idea of Habitat, I\u0026rsquo;d also love to hear any feedback you have.\nYou can get a look at the repository in its very much pre-alpha state on GitHub. Give it a watch or a star or something so that I know you\u0026rsquo;re interested.\nI have a project board which indicates the current priorities. At the moment, I\u0026rsquo;m just committing to main like a madman, but if I see someone take up an issue, I\u0026rsquo;ll start branching.\nYou can get in touch with any of the social links below. Keep an eye on this blog if you\u0026rsquo;re interested, I have some ideas on the Mesh phase that I\u0026rsquo;ll be sharing in the near future.\n","date":"24 June 2024","permalink":"/posts/building-habitat/","section":"Posts","summary":"","title":"I'm Building Habitat"},{"content":"Over the past year or so I’ve been playing with the idea of a decentralised social platform based on your location. By putting physical location at the centre of the experience, such a platform could be used to bring communities together and provide a source of local information when travelling.\nWhy Should It Exist? #The concepts of the Fediverse and Web3 play an important role in the future of communication on the internet. Platform decay (more widely known as enshittification), walled gardens, rage farming, and users becoming the product have all become the norm. These large platforms need to make a profit, and we’re slowly starting to discover that their methods of doing so are not good for us. In building open-source and distributed social platforms, we also distribute the hosting costs and administration responsibilities. This ultimately gives people the freedom to choose how they want to communicate online.\nAdditionally, the idea of being an active member of the local community might sound increasingly enticing to those of us who are done with doomscrolling, but would still like to take part in local conversation, whether to enact meaningful change in the community, to join a local jogging group, or even just to share a photo of the surrounding countryside.\nThose who don’t care about any of those things could still benefit from the byproduct of conversations taking place around a specified location. Whether at home or away on holiday, perhaps in discovering an interesting landmark, or in need of local information, the platform could tell you about existing conversations in and around the location you’re in, and if there are none, you could post one.\nHabitat: A Mockup #I\u0026rsquo;ve decided to build a proof of concept of a mobile interface that would demonstrate how such a platform could be used. I decided that Habitat is as good a name as any.\nI envision that Habitat will consist of two primary sections: Home and Nearby. Both of these sections will display posts submitted by users.\nThe Home Feed #The Home feed will display posts submitted directly to the instance of Habitat that the user is subscribed to, ordered by date. These posts could also be filtered by the user\u0026rsquo;s preference of categories.\nHabitat Home feed If desired, it could in theory be possible to create functionality for the user to essentially subscribe to multiple instances of Habitat, but the intention of this section is to show the user what is happening in their local area.\nThe Nearby Feed #The Nearby feed also displays posts, however there will be two key differences in their criteria:\nThe posts will be ordered by distance from the user\u0026rsquo;s current location, instead of by date. The posts will be sourced from any physically close Habitat instances, not necessarily the instance that the user is a subscriber of. Habitat Nearby feed I envision the Home feed as being for locals, and the Nearby feed as being for visitors.\nsequenceDiagram actor User opt Home feed User-\u003e\u003eUser's Habitat Instance: Request User's Habitat Instance-\u003e\u003eUser's Habitat Instance: Get latest posts User's Habitat Instance-\u003e\u003eUser: Latest posts end opt Nearby feed User-\u003e\u003eUser's Habitat Instance: Request loop Nearest Habitat Instances User's Habitat Instance-\u003e\u003eRemote Habitat Instance: Request Remote Habitat Instance-\u003e\u003eRemote Habitat Instance: Get nearest posts Remote Habitat Instance-\u003e\u003eUser's Habitat Instance: Nearest posts end User's Habitat Instance--\u003e\u003eUser's Habitat Instance: Get nearest posts (If applicable) User's Habitat Instance-\u003e\u003eUser: Nearest posts end Limits for each request will need to be decided. Some to consider are:\nThe maximum distance from the user to be considered \u0026ldquo;near\u0026rdquo; The maximum number of instances to call if many are near The maximum number of posts sent from each instance Categories #Given that location is such a broad subject, it\u0026rsquo;s easy to imagine that people would find the platform useful for a variety of reasons. Those interested in local landmarks may not be the same people as those interested in a book reading club.\nFor this reason, I think it would be important for Habitat instance administrators to have the ability to create their own categories, and for users to be able to filter their feeds to display posts from specified categories.\nExample Habitat post to a Landmarks category Additionally, administrators may find that some categories are not suitable for the Nearby feed. For instance, they might decide that local gossip may be suitable for the Home feed, but visitors will likely be more interested in landmarks and local Q\u0026amp;A. To keep the Nearby feed clear of everyday local conversation, it would be good for administrators to have the ability to create categories that will only ever appear in the Home feed, or to put it another way, posts that will only ever display for those who are directly subscribed to their Habitat instance.\nThis also applies to posts specifying an exact coordinate. Some categories may not require one, as they may pertain to general local conversation.\nConnecting Instances #Social platforms on the Fediverse have to deal with the issue of connecting with other instances. It seems that different platforms have varying degrees of success with this challenge, by federating with select instances, but I think that a platform built around location would have a unique property that would give it a superpower when it comes to displaying posts from the relevant instances when a user opens the Nearby tab. To connect to the relevant Habitat instances no matter where in the world the user is, we need to harness this superpower.\nThe Power of Coordinates #Lat/long coordinates are trivial to query by distance from a MySQL database. Utilising this, we could create a list of Habitat instances that are relevant to a user\u0026rsquo;s current location, and then query only those instances.\nThis query could be performed locally, so long as each Habitat instance is aware of the network as a whole. This problem requires that a shared list of all instances is communicated and routinely updated amongst connected instances.\nGossip Protocol #Gossip protocol to the rescue! This is a process by which nodes of a network routinely query each other to update shared information.\nIn our scenario, instances of Habitat would ideally have a special relationship with instances that represent places physically close. This special relationship would allow the instances to routinely compare their lists of all instances. For the sake of brevity, let\u0026rsquo;s refer to this relationship as neighbouring.\nFor example, Habitat:London might choose to be neighbours with Habitat:Birmingham, Habitat:Peterborough and Habitat:Norwich. Habitat:Birmingham might choose to be neighbours with Habitat:Notthingham and Habitat:Cardiff also. You\u0026rsquo;ll have to take this example with a pinch of salt, given that we haven\u0026rsquo;t discussed how large an instance should ideally be, but you hopefully get the idea.\nWhile each instance becomes aware of all other instances, they only query that information from their neighbours.\nI built a simulation to demonstrate this. Each circle represents a Habitat instance, and the lines represent neighbouring relationships between instances.\nThe simulation is sped up, perhaps a twice-a-day sync would be more than enough to keep the network reasonably up-to-date at all times.\nThe flashing lines show a query between two instances. As a new instance is added to the network, knowledge of its existence propagates throughout the entire network. In this video, when an instance turns blue, it has a complete list of the entire network.\nIt may also benefit the network as a whole for some instances to be neighbouring with locationally distant instances to reduce propagation time, but doing so may come with a downside. Users are probably more likely to be travelling to neighbouring towns and cities than to somewhere distant, and when using the Nearby functionality, they would better benefit from a sooner update from local instances.\nThese are only problems after thousands of connected instances. But when sharing a list of URLs and coordinates of an entire decentralised network, it\u0026rsquo;s certainly something that should be considered.\nGrowing Pains #As such a network grows, it would become more resource-intensive to routinely share a full list of all instances. Something as simple as static file-based caching for the list will probably go a long way to help with this. With only a few thousand instances, the list might not be much different in filesize than this very article. One download twice a day sounds easily doable. But I\u0026rsquo;m thinking about the ideal scenario. Ideally, my local town would have its own instance. Small instances that are cheap to host with truly local posts would be the dream, but that dream requires something more carefully considered than routinely comparing a list of potentially millions of URLs and coordinates.\nBloom Filters #A Bloom filter is a method we can use to have an instance request a string which represents a neighbour\u0026rsquo;s list. This string would be substantially smaller than the list itself. The instance could use this string to generate a list of instances which its neighbour is missing and send only those items back. The neighbouring instance could then do the same so that both instances will end up with identical lists.\nHow Big Is Too Big? #Given that such a social platform would be fragmented by design, it would be unsurprising to find that gaining a flourishing community in a single instance would be a challenge. For this reason, it might be tempting to create larger instances. This is not how I personally envision such a platform, but it\u0026rsquo;s important to consider the best path to that ideal.\nIt may be important for an administrator to be able to create Areas within their instance so that users can further filter by their local district. What if, after growing, the administrator would prefer to not pay for and administer the hosting of their entire county, but instead only for their local town? Perhaps it should be possible to export data for entire Areas to be moved to new instances. Or, perhaps the simpler solution, it should be possible for some administrators to be permitted to administer specific Areas of an instance only.\nWhere Do We Go From Here? #There are a great deal of unknowns right now, and I could really do with feedback. If this article could entice someone to help make it a reality, that\u0026rsquo;d be wonderful! But I don\u0026rsquo;t know if it\u0026rsquo;s something people would want, or if it\u0026rsquo;s something that only I want.\nI think the very next thing is to see if the idea stirs conversation, so please drop me any feedback. Here are some questions you might be able to answer:\nDo you think any technical issues would prevent this from being feasible? How should it be different from what I\u0026rsquo;ve described? Do you think it\u0026rsquo;s something that you\u0026rsquo;d like to use? ","date":"13 April 2024","permalink":"/posts/location-based-social-network/","section":"Posts","summary":"","title":"Could We Build a Decentralised Social Platform Rooted in Place?"},{"content":"","date":null,"permalink":"/tags/ideas/","section":"Tags","summary":"","title":"Ideas"},{"content":"","date":null,"permalink":"/categories/","section":"Categories","summary":"","title":"Categories"}]